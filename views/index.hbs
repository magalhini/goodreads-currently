<!DOCTYPE html>
<html lang="en">
{{>header}}
<body>

  <div class="container">
    <h1 class="main-title">Currently Reading</h1>
    <p class="main-subtitle">Your books from Goodreads</p>
    <div class="helper-section">
      <label class="helper__title">What's your Goodreads ID?</label>
      <input class="input input--large" type="text" name="" value="">
      <button class="button" id="get-books" type="button" name="button">Display my books</button>
      <p>
        <a href="#">(want the <code>JSON</code> response instead?)</a>
      </p>
    </div>
    <p>Throw a <code>GET</code> request to <code>/reading/USER_ID</code> to fetch all books you're currently reading</p>
    <p>You can add <code>/json</code> to the URI in order to get the raw response.</p>
  </div>

  <script type="text/javascript">
    function compose(f, g) {
      return function(x) {
        return f(g(x));
      }
    }

    var getValue = function(el) {
      return el.target.value;
    };

    function Index() {
      this.inputField = document.querySelector('.input');
      this.getBooksButton = document.getElementById('get-books');
      this.patternID = /\d+/g;
      this.extractID = this.extractID.bind(this);
      this.getBooks = this.getBooks.bind(this);
      this.getID = compose(this.extractID, getValue);
    }

    Index.prototype.extractID = function(val) {
      this.goodreadsID = val.match(this.patternID) ? val.match(this.patternID)[0] : null;
    };

    Index.prototype.getBooks = function(e) {
      if (this.goodreadsID) {
        window.location = '/reading/' + this.goodreadsID;
      }
    }

    Index.prototype.init = function() {
      this.inputField.addEventListener('keyup', this.getID);
      this.getBooksButton.addEventListener('click', this.getBooks);
    };

    var app = new Index();
    app.init();
  </script>
</body>
</html>
